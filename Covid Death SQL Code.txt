SELECT *
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_vaccinations
where continent is not null
order by 3, 4

SELECT *
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
where continent is not null
order by 3, 4

-- Select Data that we are going to be using--

SELECT location, date, total_cases, new_cases, total_deaths, population
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
where continent is not null
order by 1, 2

-- Looking at Total cases Vs total deaths --

SELECT location, date, total_cases, total_deaths, (total_deaths/total_cases)*100 as death_percentage
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
WHERE location = 'Canada' and
continent is not null
order by 1, 2


-- Looking at Total cases Vs Population. Shows what percentage of population got covid--

SELECT location, date, total_cases, population, (total_cases/population)*100 as percent_popluation_infected
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
WHERE location = 'Canada'
order by 1, 2

-- Looking at countries with highest infection rate compared to population --

SELECT location, population, MAX(total_cases) as highest_infection_count, MAX((total_cases/population))*100 as percent_population_infected
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
where continent is not null
GROUP BY location, population
order by percent_population_infected desc



-- Countries with the highest death count per population --

SELECT location, MAX(total_deaths) as total_death_count
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
where continent is not null
GROUP BY location
order by total_death_count desc


-- Showing continents with highest death count-- 

SELECT continent, MAX(total_deaths) as total_death_count
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
where continent is not null
GROUP BY continent
order by total_death_count desc


--Global numbers --

SELECT date, Sum(new_cases) as total_cases, SUM(cast(new_deaths as int)) as total_deaths, SUM(cast(new_deaths as int))/Sum(new_cases)*100 as death_percentage
FROM my-project-2024-410616.Covid_Portfolio_Project.covid_deaths
WHERE continent is not null
GROUP BY date
order by 1, 2


-- Looking at the total population Vs vaccinations--


WITH pop_vs_vac
AS
(
Select death.continent, death.location, death.date, death.population, vac.new_vaccinations, SUM(cast(vac.new_vaccinations as int)) OVER (PARTITION BY death.location order by death.location, death.date) as rolling_people_vaccinated
From my-project-2024-410616.Covid_Portfolio_Project.covid_deaths as death
JOIN my-project-2024-410616.Covid_Portfolio_Project.covid_vaccinations as vac
  ON death.location = vac.location
  and death.date = vac.date
WHERE death.continent is not null
--ORDER BY 2, 3
)
SELECT *, (rolling_people_vaccinated/population)*100
FROM pop_vs_vac


-- Tempt table

DROP Table if exists Covid_Portfolio_Project.percentpopulationvaccinated;
CREATE TABLE Covid_Portfolio_Project.percentpopulationvaccinated
(
continent string,
location string,
date date,
population float64,
new_vaccinations float64,
rolling_people_vaccinated float64
);

INSERT INTO Covid_Portfolio_Project.percentpopulationvaccinated
Select death.continent, death.location, death.date, death.population, vac.new_vaccinations, SUM(cast(vac.new_vaccinations as int)) OVER (PARTITION BY death.location order by death.location, death.date) as rolling_people_vaccinated
From my-project-2024-410616.Covid_Portfolio_Project.covid_deaths as death
JOIN my-project-2024-410616.Covid_Portfolio_Project.covid_vaccinations as vac
  ON death.location = vac.location
  and death.date = vac.date
WHERE death.continent is not null;
--ORDER BY 2, 3

SELECT *, (rolling_people_vaccinated/population)*100
FROM Covid_Portfolio_Project.percentpopulationvaccinated


Create View Covid_Portfolio_Project.percentpopulationvaccinated as
Select death.continent, death.location, death.date, death.population, vac.new_vaccinations, SUM(cast(vac.new_vaccinations as int)) OVER (PARTITION BY death.location order by death.location, death.date) as rolling_people_vaccinated
From my-project-2024-410616.Covid_Portfolio_Project.covid_deaths as death
JOIN my-project-2024-410616.Covid_Portfolio_Project.covid_vaccinations as vac
  ON death.location = vac.location
  and death.date = vac.date
WHERE death.continent is not null;